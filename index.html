<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local List Manager | Pro Visual</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap');
        
        body { font-family: 'Inter', sans-serif; color: #3c4043; }
        
        .animate-in { animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Aspect Ratio Helpers */
        .aspect-square { aspect-ratio: 1 / 1; }
        .aspect-video { aspect-ratio: 16 / 9; }
        .aspect-standard { aspect-ratio: 4 / 3; }

        .upload-zone {
            border: 2px dashed #dadce0;
            transition: all 0.2s;
            position: relative;
            background: #f8f9fa;
        }

        .upload-zone.dragging {
            border-color: #4285f4;
            background-color: #e8f0fe;
        }

        /* Image Adjustment UI */
        #adjustmentOverlay {
            background: rgba(0,0,0,0.8);
            display: none;
        }
        
        .ratio-btn.active {
            background-color: #1a73e8;
            color: white;
            border-color: #1a73e8;
        }
    </style>
</head>
<body class="bg-[#f1f3f4] min-h-screen flex flex-col">

    <!-- Header -->
    <header class="h-16 border-b border-[#dadce0] flex items-center justify-between px-6 sticky top-0 bg-white z-30">
        <div class="flex items-center gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#4285f4" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M3 9h18"/><path d="M9 21V9"/></svg>
            <span class="text-xl text-[#5f6368] font-medium tracking-tight">Visual List</span>
        </div>

        <div class="flex-1 max-w-xl mx-8 hidden md:block">
            <div class="relative">
                <input type="text" id="searchInput" placeholder="Search your records..." class="w-full bg-[#f1f3f4] border-none focus:bg-white focus:ring-2 focus:ring-blue-100 py-2.5 pl-10 pr-4 rounded-full outline-none transition-all text-sm">
                <svg class="absolute left-3.5 top-1/2 -translate-y-1/2 text-[#5f6368]" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
            </div>
        </div>

        <button id="settingsBtn" class="p-2 hover:bg-gray-100 rounded-full text-[#5f6368]">
            <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        </button>
    </header>

    <main class="flex-1 overflow-y-auto">
        <div class="max-w-5xl mx-auto p-6">
            <!-- Controls -->
            <div class="flex items-center justify-between mb-8">
                <div class="flex items-center gap-4">
                    <h2 class="text-2xl font-semibold text-[#202124]">Timeline</h2>
                    <select id="sortSelect" class="bg-white border border-[#dadce0] rounded-lg px-3 py-1.5 text-xs font-medium focus:outline-none">
                        <option value="date-desc">Newest First</option>
                        <option value="date-asc">Oldest First</option>
                        <option value="alpha">A - Z</option>
                    </select>
                </div>
                <button id="addItemBtn" class="bg-[#1a73e8] hover:bg-[#1557b0] text-white px-6 py-2.5 rounded-full font-medium text-sm shadow-md transition-all flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    New Entry
                </button>
            </div>

            <!-- List -->
            <div id="itemsContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Items injected here -->
            </div>
        </div>
    </main>

    <!-- Settings Sidebar -->
    <div id="settingsSidebar" class="hidden fixed inset-0 z-50 bg-black/30 backdrop-blur-sm">
        <div class="absolute right-0 top-0 h-full w-80 bg-white shadow-2xl p-8 animate-in">
            <div class="flex justify-between items-center mb-8">
                <h3 class="text-xl font-bold">Options</h3>
                <button id="closeSettingsBtn" class="p-2 hover:bg-gray-100 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>
            <div class="space-y-4">
                <button id="exportBtn" class="w-full text-left p-4 rounded-xl border border-gray-200 hover:bg-gray-50 flex items-center gap-3 font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Backup Data (JSON)
                </button>
                <button id="wipeBtn" class="w-full text-left p-4 rounded-xl border border-red-100 hover:bg-red-50 text-red-600 flex items-center gap-3 font-medium">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>
                    Clear All Content
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Modal -->
    <div id="addModal" class="hidden fixed inset-0 z-40 bg-black/60 backdrop-blur-md p-4 flex items-center justify-center">
        <form id="addForm" class="bg-white rounded-3xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[95vh] animate-in">
            <div class="p-6 border-b flex justify-between items-center bg-gray-50">
                <h3 id="modalTitle" class="text-lg font-bold text-[#202124]">Entry Details</h3>
                <button type="button" class="closeModalBtn p-2 hover:bg-gray-200 rounded-full">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>

            <div class="p-8 overflow-y-auto space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- Text Data -->
                    <div class="space-y-5">
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-400 uppercase tracking-widest">Title</label>
                            <input id="titleInput" required placeholder="What's the memory?" class="w-full text-xl border-b-2 border-gray-100 focus:border-blue-500 outline-none py-2 font-medium transition-all">
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-400 uppercase tracking-widest">Date</label>
                            <input type="date" id="dateInput" class="w-full bg-gray-50 rounded-xl px-4 py-3 border border-gray-100 outline-none font-medium">
                        </div>
                        <div class="space-y-1">
                            <label class="text-xs font-bold text-gray-400 uppercase tracking-widest">Description</label>
                            <textarea id="noteInput" placeholder="Write something..." class="w-full bg-gray-50 rounded-xl px-4 py-3 border border-gray-100 outline-none h-32 resize-none"></textarea>
                        </div>
                    </div>

                    <!-- Image Section -->
                    <div class="space-y-4">
                        <label class="text-xs font-bold text-gray-400 uppercase tracking-widest">Visual Attachment</label>
                        <div id="imageContainer" class="relative group">
                            <!-- Ratio Selectors (Overlay on preview) -->
                            <div id="imageControls" class="hidden absolute top-3 left-1/2 -translate-x-1/2 z-10 flex gap-1 bg-black/70 backdrop-blur-md p-1 rounded-lg border border-white/20">
                                <button type="button" data-ratio="original" class="ratio-btn px-2 py-1 text-[10px] font-bold text-white rounded hover:bg-white/20">ORIG</button>
                                <button type="button" data-ratio="1-1" class="ratio-btn px-2 py-1 text-[10px] font-bold text-white rounded hover:bg-white/20">1:1</button>
                                <button type="button" data-ratio="4-3" class="ratio-btn px-2 py-1 text-[10px] font-bold text-white rounded hover:bg-white/20">4:3</button>
                                <button type="button" data-ratio="16-9" class="ratio-btn px-2 py-1 text-[10px] font-bold text-white rounded hover:bg-white/20">16:9</button>
                            </div>

                            <div id="dropZone" class="upload-zone rounded-2xl aspect-square flex flex-col items-center justify-center cursor-pointer overflow-hidden group">
                                <input type="file" id="imageInput" class="hidden" accept="image/*">
                                
                                <div id="uploadUi" class="text-center p-6">
                                    <div class="w-16 h-16 bg-blue-50 text-blue-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect width="18" height="18" x="3" y="3" rx="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>
                                    </div>
                                    <p class="text-sm font-bold text-gray-500">Drop Photo Here</p>
                                    <p class="text-[10px] text-gray-400 mt-1 uppercase">JPG, PNG, WEBP</p>
                                </div>

                                <div id="previewWrapper" class="hidden absolute inset-0 bg-gray-100 flex items-center justify-center overflow-hidden">
                                    <img id="previewImg" class="w-full h-full object-cover transition-transform origin-center" style="transform: scale(1);">
                                    
                                    <!-- Zoom control -->
                                    <div class="absolute bottom-4 left-4 right-4 bg-black/60 backdrop-blur-md px-3 py-2 rounded-full flex items-center gap-3">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
                                        <input type="range" id="zoomRange" min="1" max="3" step="0.1" value="1" class="flex-1 h-1 bg-white/30 rounded-full appearance-none accent-white">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/><line x1="11" y1="8" x2="11" y2="14"/><line x1="8" y1="11" x2="14" y2="11"/></svg>
                                    </div>

                                    <button type="button" id="removeImgBtn" class="absolute top-3 right-3 bg-red-500 text-white p-2 rounded-full shadow-lg hover:scale-110 transition-transform">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="mt-3 flex items-center justify-between">
                                <span class="text-[10px] font-bold text-gray-400 uppercase">Fit Mode</span>
                                <button type="button" id="fitToggle" class="text-[10px] font-bold px-3 py-1 rounded bg-gray-100 text-gray-600 hover:bg-gray-200 uppercase">Cover</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="p-6 border-t bg-gray-50 flex justify-end gap-3">
                <button type="button" class="closeModalBtn px-6 py-2.5 rounded-xl font-bold text-gray-500 hover:bg-gray-200 transition-all">Cancel</button>
                <button type="submit" class="bg-[#1a73e8] text-white px-10 py-2.5 rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-[#1557b0] transition-all">Save Memory</button>
            </div>
        </form>
    </div>

    <!-- Item Template -->
    <template id="itemTemplate">
        <div class="item-card bg-white rounded-3xl overflow-hidden shadow-sm hover:shadow-xl transition-all duration-300 border border-gray-100 group flex flex-col">
            <div class="img-container relative bg-gray-50 overflow-hidden">
                <img class="card-img w-full h-full transition-transform duration-500 group-hover:scale-105">
                <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                <div class="absolute bottom-4 left-4 right-4 flex justify-between items-center opacity-0 translate-y-2 group-hover:opacity-100 group-hover:translate-y-0 transition-all">
                    <span class="card-date text-[10px] font-bold text-white uppercase tracking-widest px-2 py-1 bg-black/20 backdrop-blur-md rounded"></span>
                    <div class="flex gap-1">
                        <button class="editBtn p-2 bg-white/90 rounded-full text-gray-800 hover:bg-white shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>
                        </button>
                        <button class="deleteBtn p-2 bg-red-500/90 rounded-full text-white hover:bg-red-500 shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                        </button>
                    </div>
                </div>
            </div>
            <div class="p-5 space-y-2">
                <h4 class="card-title font-bold text-[#202124] text-lg leading-tight line-clamp-1"></h4>
                <p class="card-note text-sm text-[#5f6368] line-clamp-2 leading-relaxed"></p>
            </div>
        </div>
    </template>

    <script>
        // --- DB Logic (IndexedDB) ---
        const DB_NAME = 'VisualMemoriesDB';
        const STORE_NAME = 'memories';
        let db;

        const request = indexedDB.open(DB_NAME, 2);
        request.onupgradeneeded = (e) => {
            const db = e.target.result;
            if (!db.objectStoreNames.contains(STORE_NAME)) {
                db.createObjectStore(STORE_NAME, { keyPath: 'id' });
            }
        };
        request.onsuccess = (e) => {
            db = e.target.result;
            loadMemories();
        };

        // --- State ---
        let memories = [];
        let editingId = null;
        let activeRatio = '1-1';
        let fitMode = 'cover';
        let zoomLevel = 1;
        let currentImgBase64 = null;

        // --- UI Elements ---
        const container = document.getElementById('itemsContainer');
        const addModal = document.getElementById('addModal');
        const dropZone = document.getElementById('dropZone');
        const previewImg = document.getElementById('previewImg');
        const previewWrapper = document.getElementById('previewWrapper');
        const uploadUi = document.getElementById('uploadUi');
        const zoomRange = document.getElementById('zoomRange');
        const fitToggle = document.getElementById('fitToggle');
        const imageControls = document.getElementById('imageControls');

        // --- Core Functions ---
        async function loadMemories() {
            const tx = db.transaction(STORE_NAME, 'readonly');
            const store = tx.objectStore(STORE_NAME);
            const req = store.getAll();
            req.onsuccess = () => {
                memories = req.result;
                render();
            };
        }

        function render() {
            container.innerHTML = '';
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sort = document.getElementById('sortSelect').value;

            let filtered = memories.filter(m => m.title.toLowerCase().includes(search) || m.note.toLowerCase().includes(search));

            if (sort === 'date-desc') filtered.sort((a,b) => new Date(b.date) - new Date(a.date));
            else if (sort === 'date-asc') filtered.sort((a,b) => new Date(a.date) - new Date(b.date));
            else filtered.sort((a,b) => a.title.localeCompare(b.title));

            const template = document.getElementById('itemTemplate');
            filtered.forEach(m => {
                const clone = template.content.cloneNode(true);
                const card = clone.querySelector('.item-card');
                const imgCont = clone.querySelector('.img-container');
                const img = clone.querySelector('.card-img');
                
                // Set Ratio
                if (m.ratio === '1-1') imgCont.classList.add('aspect-square');
                else if (m.ratio === '16-9') imgCont.classList.add('aspect-video');
                else if (m.ratio === '4-3') imgCont.classList.add('aspect-standard');
                else imgCont.style.aspectRatio = 'auto';

                img.src = m.image;
                img.style.objectFit = m.fit || 'cover';
                img.style.transform = `scale(${m.zoom || 1})`;
                
                clone.querySelector('.card-title').textContent = m.title;
                clone.querySelector('.card-note').textContent = m.note;
                clone.querySelector('.card-date').textContent = new Date(m.date).toLocaleDateString(undefined, { month: 'short', day: 'numeric', year: 'numeric'});

                clone.querySelector('.deleteBtn').onclick = () => {
                    const tx = db.transaction(STORE_NAME, 'readwrite');
                    tx.objectStore(STORE_NAME).delete(m.id);
                    memories = memories.filter(item => item.id !== m.id);
                    render();
                };

                clone.querySelector('.editBtn').onclick = () => openModal(m);

                container.appendChild(clone);
            });
        }

        function updateImageDisplay() {
            // Apply Fit
            previewImg.style.objectFit = fitMode;
            fitToggle.textContent = fitMode === 'cover' ? 'Fill' : 'Fit';
            
            // Apply Zoom
            previewImg.style.transform = `scale(${zoomLevel})`;

            // Apply Ratio UI
            dropZone.classList.remove('aspect-square', 'aspect-video', 'aspect-standard');
            dropZone.style.aspectRatio = 'auto';

            if (activeRatio === '1-1') dropZone.classList.add('aspect-square');
            else if (activeRatio === '4-3') dropZone.classList.add('aspect-standard');
            else if (activeRatio === '16-9') dropZone.classList.add('aspect-video');
            
            // Highlight active button
            document.querySelectorAll('.ratio-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.ratio === activeRatio);
            });
        }

        function openModal(item = null) {
            editingId = item ? item.id : null;
            document.getElementById('modalTitle').textContent = item ? 'Edit Memory' : 'New Memory';
            document.getElementById('addForm').reset();
            
            if (item) {
                document.getElementById('titleInput').value = item.title;
                document.getElementById('dateInput').value = item.date;
                document.getElementById('noteInput').value = item.note;
                currentImgBase64 = item.image;
                previewImg.src = item.image;
                activeRatio = item.ratio || '1-1';
                fitMode = item.fit || 'cover';
                zoomLevel = item.zoom || 1;
                zoomRange.value = zoomLevel;
                
                previewWrapper.classList.remove('hidden');
                uploadUi.classList.add('hidden');
                imageControls.classList.remove('hidden');
            } else {
                document.getElementById('dateInput').value = new Date().toISOString().split('T')[0];
                currentImgBase64 = null;
                activeRatio = '1-1';
                fitMode = 'cover';
                zoomLevel = 1;
                zoomRange.value = 1;
                previewWrapper.classList.add('hidden');
                uploadUi.classList.remove('hidden');
                imageControls.classList.add('hidden');
            }
            
            updateImageDisplay();
            addModal.classList.remove('hidden');
        }

        // --- Interaction ---
        document.getElementById('addItemBtn').onclick = () => openModal();
        document.querySelectorAll('.closeModalBtn').forEach(b => b.onclick = () => addModal.classList.add('hidden'));

        // Image Handling
        dropZone.onclick = () => document.getElementById('imageInput').click();
        document.getElementById('imageInput').onchange = e => {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = ev => {
                currentImgBase64 = ev.target.result;
                previewImg.src = currentImgBase64;
                previewWrapper.classList.remove('hidden');
                uploadUi.classList.add('hidden');
                imageControls.classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        };

        // Ratio Controls
        document.querySelectorAll('.ratio-btn').forEach(btn => {
            btn.onclick = (e) => {
                e.stopPropagation();
                activeRatio = btn.dataset.ratio;
                updateImageDisplay();
            };
        });

        // Fit Mode Toggle
        fitToggle.onclick = () => {
            fitMode = fitMode === 'cover' ? 'contain' : 'cover';
            updateImageDisplay();
        };

        // Zoom Slider
        zoomRange.oninput = (e) => {
            zoomLevel = e.target.value;
            updateImageDisplay();
        };

        // Remove Image
        document.getElementById('removeImgBtn').onclick = (e) => {
            e.stopPropagation();
            currentImgBase64 = null;
            previewWrapper.classList.add('hidden');
            uploadUi.classList.remove('hidden');
            imageControls.classList.add('hidden');
        };

        // Save
        document.getElementById('addForm').onsubmit = (e) => {
            e.preventDefault();
            const memory = {
                id: editingId || crypto.randomUUID(),
                title: document.getElementById('titleInput').value,
                date: document.getElementById('dateInput').value,
                note: document.getElementById('noteInput').value,
                image: currentImgBase64,
                ratio: activeRatio,
                fit: fitMode,
                zoom: zoomLevel,
                updatedAt: Date.now()
            };

            const tx = db.transaction(STORE_NAME, 'readwrite');
            tx.objectStore(STORE_NAME).put(memory);
            
            if (editingId) memories = memories.map(m => m.id === editingId ? memory : m);
            else memories.push(memory);
            
            render();
            addModal.classList.add('hidden');
        };

        // Search/Sort
        document.getElementById('searchInput').oninput = render;
        document.getElementById('sortSelect').onchange = render;

        // Settings
        document.getElementById('settingsBtn').onclick = () => document.getElementById('settingsSidebar').classList.remove('hidden');
        document.getElementById('closeSettingsBtn').onclick = () => document.getElementById('settingsSidebar').classList.add('hidden');

        document.getElementById('wipeBtn').onclick = () => {
            if (confirm("Erase all items?")) {
                const tx = db.transaction(STORE_NAME, 'readwrite');
                tx.objectStore(STORE_NAME).clear();
                memories = [];
                render();
                document.getElementById('settingsSidebar').classList.add('hidden');
            }
        };

        document.getElementById('exportBtn').onclick = () => {
            const dataStr = JSON.stringify(memories);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'visual-list-backup.json';
            a.click();
        };

    </script>
</body>
</html>
